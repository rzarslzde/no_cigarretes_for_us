<!doctype html>
<html lang="en" class="h-full">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Quit Timer</title>

  <!-- Tailwind via CDN for a clean, fancy UI (no build needed) -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Luxon for precise calendar unit diffs -->
  <script src="https://cdn.jsdelivr.net/npm/luxon@3/build/global/luxon.min.js"></script>

  <style>
    /* Subtle glass effect card */
    .glass {
      backdrop-filter: blur(10px);
      background: rgba(255, 255, 255, 0.08);
      border: 1px solid rgba(255, 255, 255, 0.12);
    }
    /* Smooth digit flip feel */
    .tick { transition: transform .2s ease, opacity .2s ease; will-change: transform, opacity; }
    .tick-enter { transform: translateY(8px); opacity: 0; }
    .tick-show  { transform: translateY(0);   opacity: 1; }
  </style>
</head>
<body class="h-full bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 text-white">
  <main class="min-h-screen flex items-center justify-center p-6">
    <div class="w-full max-w-3xl">
      <!-- Header -->
      <header class="mb-8 text-center">
        <div class="inline-flex items-center gap-2 px-3 py-1 rounded-full bg-emerald-500/10 ring-1 ring-emerald-400/30">
          <span class="text-emerald-300 text-sm">üíö Smoke-Free Journey</span>
        </div>
        <h1 id="title" class="mt-4 text-3xl sm:text-4xl font-semibold tracking-tight">
          Time since I quit cigarettes
        </h1>
        <p class="mt-2 text-slate-300/80 text-sm">
          Reading <code class="text-slate-200">start-date.json</code> from this repository
        </p>
      </header>

      <!-- Card -->
      <section class="glass rounded-2xl p-6 sm:p-10 shadow-2xl">
        <!-- Big timer line -->
        <p id="timer"
           class="text-xl sm:text-2xl leading-relaxed font-medium text-slate-100 text-center">
          Loading‚Ä¶
        </p>

        <!-- Milestones -->
        <div class="mt-8 grid grid-cols-2 sm:grid-cols-3 gap-4">
          <div class="rounded-xl p-4 bg-emerald-400/10 ring-1 ring-emerald-400/20">
            <div class="text-sm text-emerald-300">Cigarette-free</div>
            <div id="daysTotal" class="mt-1 text-2xl font-semibold">‚Äî</div>
            <div class="text-xs text-slate-400">total days</div>
          </div>
          <div class="rounded-xl p-4 bg-sky-400/10 ring-1 ring-sky-400/20">
            <div class="text-sm text-sky-300">Hours</div>
            <div id="hoursTotal" class="mt-1 text-2xl font-semibold">‚Äî</div>
            <div class="text-xs text-slate-400">since quitting</div>
          </div>
          <div class="rounded-xl p-4 bg-fuchsia-400/10 ring-1 ring-fuchsia-400/20">
            <div class="text-sm text-fuchsia-300">Money saved</div>
            <div id="moneySaved" class="mt-1 text-2xl font-semibold">‚Äî</div>
            <div class="text-xs text-slate-400">estimation (optional)</div>
          </div>
        </div>

        <!-- Footer -->
        <div class="mt-8 flex flex-col sm:flex-row items-center justify-between gap-3 text-slate-400 text-sm">
          <div>
            <span class="mr-2">‚è±Ô∏è Updates every second</span>
            <span id="startInfo" class="font-mono text-slate-300"></span>
          </div>
          <button id="toggleTheme"
                  class="px-3 py-1.5 rounded-lg bg-white/10 hover:bg-white/20 transition">
            Toggle theme
          </button>
        </div>
      </section>
    </div>
  </main>

  <script>
    (function () {
      const { DateTime, Duration } = luxon;

      const elTitle      = document.getElementById('title');
      const elTimer      = document.getElementById('timer');
      const elDaysTotal  = document.getElementById('daysTotal');
      const elHoursTotal = document.getElementById('hoursTotal');
      const elMoney      = document.getElementById('moneySaved');
      const elStartInfo  = document.getElementById('startInfo');
      const btnTheme     = document.getElementById('toggleTheme');

      // Optional money config (edit here if you want):
      // avg packs/day * price per pack (your currency)
      const packsPerDay = 1;      // change if needed
      const pricePerPack = 3.5;   // change if needed

      let startDate = null;

      // Simple theme toggle (dark by default)
      btnTheme.addEventListener('click', () => {
        document.documentElement.classList.toggle('inverted');
        document.body.classList.toggle('bg-white');
      });

      function fmt(parts) {
        return `${parts.years} years, ${parts.months} months, ${parts.days} days, ` +
               `${parts.hours} hours, ${parts.minutes} minutes and ${parts.seconds} seconds`;
      }

      function calcDiff(now, start) {
        // Use Luxon to get calendar-accurate units
        const diff = start.until(now).toDuration(['years','months','days','hours','minutes','seconds']).shiftTo(
          'years','months','days','hours','minutes','seconds'
        );

        // Floor each unit (seconds rounded down)
        const years   = Math.floor(diff.years);
        const months  = Math.floor(diff.months);
        const days    = Math.floor(diff.days);
        const hours   = Math.floor(diff.hours);
        const minutes = Math.floor(diff.minutes);
        const seconds = Math.floor(diff.seconds);

        return { years, months, days, hours, minutes, seconds };
      }

      function tick() {
        if (!startDate) return;
        const now = DateTime.now();
        const parts = calcDiff(now, startDate);

        // Update main line with a tiny flip effect
        elTimer.classList.add('tick','tick-enter');
        requestAnimationFrame(() => {
          elTimer.textContent = fmt(parts);
          elTimer.classList.remove('tick-enter'); elTimer.classList.add('tick-show');
          setTimeout(() => elTimer.classList.remove('tick','tick-show'), 150);
        });

        // Totals
        const totalHours = Math.floor(now.diff(startDate, 'hours').hours);
        const totalDays  = Math.floor(now.diff(startDate, 'days').days);

        elDaysTotal.textContent  = totalDays.toLocaleString();
        elHoursTotal.textContent = totalHours.toLocaleString();

        // Optional: money saved estimation
        const money = totalDays * packsPerDay * pricePerPack;
        elMoney.textContent = money.toLocaleString(undefined, { maximumFractionDigits: 2 });
      }

      async function loadConfig() {
        try {
          const res = await fetch('./start-date.json', { cache: 'no-store' });
          if (!res.ok) throw new Error('Cannot read start-date.json');
          const json = await res.json();
          if (!json.start) throw new Error('Missing "start" field in start-date.json');

          // Parse with Luxon; accept timezone if provided
          startDate = DateTime.fromISO(json.start, { setZone: true });
          if (!startDate.isValid) throw new Error('Invalid ISO date in start-date.json');

          if (json.title) elTitle.textContent = json.title;
          elStartInfo.textContent = `Start: ${startDate.toISO({ suppressMilliseconds: true })}`;

          // Start ticking
          tick();
          setInterval(tick, 1000);
        } catch (err) {
          console.error(err);
          elTimer.textContent = 'Error: could not load start-date.json. Make sure the file exists on your branch.';
        }
      }

      loadConfig();
    })();
  </script>
</body>
</html>
