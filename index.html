<!doctype html>
<html lang="en" class="h-full">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Quit Timer</title>

  <!-- Tailwind via CDN -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Luxon for accurate date differences -->
  <script src="https://cdn.jsdelivr.net/npm/luxon@3/build/global/luxon.min.js"></script>

  <style>
    .glass {
      backdrop-filter: blur(10px);
      background: rgba(255, 255, 255, 0.08);
      border: 1px solid rgba(255, 255, 255, 0.12);
    }
    .tick { transition: transform .2s ease, opacity .2s ease; will-change: transform, opacity; }
    .tick-enter { transform: translateY(8px); opacity: 0; }
    .tick-show  { transform: translateY(0);   opacity: 1; }
  </style>
</head>
<body class="h-full bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 text-white">
  <main class="min-h-screen flex items-center justify-center p-6">
    <div class="w-full max-w-3xl">
      <!-- Header -->
      <header class="mb-8 text-center">
        <div class="inline-flex items-center gap-2 px-3 py-1 rounded-full bg-emerald-500/10 ring-1 ring-emerald-400/30">
          <span class="text-emerald-300 text-sm">üíö Smoke-Free Journey</span>
        </div>
        <h1 id="title" class="mt-4 text-3xl sm:text-4xl font-semibold tracking-tight">
          Time since I quit cigarettes
        </h1>
        <p class="mt-2 text-slate-300/80 text-sm">
          Reading <code class="text-slate-200">start-date.json</code> from this repository
        </p>
      </header>

      <!-- Card -->
      <section class="glass rounded-2xl p-6 sm:p-10 shadow-2xl">
        <p id="timer"
           class="text-xl sm:text-2xl leading-relaxed font-medium text-slate-100 text-center">
          Loading‚Ä¶
        </p>

        <!-- Milestones -->
        <div class="mt-8 grid grid-cols-2 gap-4">
          <div class="rounded-xl p-4 bg-emerald-400/10 ring-1 ring-emerald-400/20 text-center">
            <div class="text-sm text-emerald-300">Cigarette-free</div>
            <div id="daysTotal" class="mt-1 text-2xl font-semibold">‚Äî</div>
            <div class="text-xs text-slate-400">total days</div>
          </div>
          <div class="rounded-xl p-4 bg-sky-400/10 ring-1 ring-sky-400/20 text-center">
            <div class="text-sm text-sky-300">Hours</div>
            <div id="hoursTotal" class="mt-1 text-2xl font-semibold">‚Äî</div>
            <div class="text-xs text-slate-400">since quitting</div>
          </div>
        </div>

        <!-- Footer -->
        <div class="mt-8 text-center text-slate-400 text-sm">
          <span>‚è±Ô∏è Updates every second ‚Äî </span>
          <span id="startInfo" class="font-mono text-slate-300"></span>
        </div>
      </section>
    </div>
  </main>

  <script>
    (function () {
      const { DateTime } = luxon;

      const elTitle      = document.getElementById('title');
      const elTimer      = document.getElementById('timer');
      const elDaysTotal  = document.getElementById('daysTotal');
      const elHoursTotal = document.getElementById('hoursTotal');
      const elStartInfo  = document.getElementById('startInfo');

      let startDate = null;

      function fmt(parts) {
        return `${parts.years} years, ${parts.months} months, ${parts.days} days, ` +
               `${parts.hours} hours, ${parts.minutes} minutes and ${parts.seconds} seconds`;
      }

      function calcDiff(now, start) {
        const diff = start.until(now)
          .toDuration(['years','months','days','hours','minutes','seconds'])
          .shiftTo('years','months','days','hours','minutes','seconds');

        return {
          years:   Math.floor(diff.years),
          months:  Math.floor(diff.months),
          days:    Math.floor(diff.days),
          hours:   Math.floor(diff.hours),
          minutes: Math.floor(diff.minutes),
          seconds: Math.floor(diff.seconds)
        };
      }

      function tick() {
        if (!startDate) return;
        const now = DateTime.now();
        const parts = calcDiff(now, startDate);

        elTimer.classList.add('tick','tick-enter');
        requestAnimationFrame(() => {
          elTimer.textContent = fmt(parts);
          elTimer.classList.remove('tick-enter');
          elTimer.classList.add('tick-show');
          setTimeout(() => elTimer.classList.remove('tick','tick-show'), 150);
        });

        elDaysTotal.textContent  = Math.floor(now.diff(startDate, 'days').days).toLocaleString();
        elHoursTotal.textContent = Math.floor(now.diff(startDate, 'hours').hours).toLocaleString();
      }

      async function loadConfig() {
        try {
          const res = await fetch('./start-date.json', { cache: 'no-store' });
          if (!res.ok) throw new Error('Cannot read start-date.json');
          const json = await res.json();
          if (!json.start) throw new Error('Missing "start" field in start-date.json');

          startDate = DateTime.fromISO(json.start, { setZone: true });
          if (!startDate.isValid) throw new Error('Invalid ISO date in start-date.json');

          if (json.title) elTitle.textContent = json.title;
          elStartInfo.textContent = `Start: ${startDate.toISO({ suppressMilliseconds: true })}`;

          tick();
          setInterval(tick, 1000);
        } catch (err) {
          console.error(err);
          elTimer.textContent = 'Error: could not load start-date.json. Make sure the file exists.';
        }
      }

      loadConfig();
    })();
  </script>
</body>
</html>
